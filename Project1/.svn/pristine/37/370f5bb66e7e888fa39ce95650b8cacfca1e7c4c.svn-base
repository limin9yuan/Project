<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bootdo.contract.dao.ContractDao">

	<select id="get" resultType="com.bootdo.contract.domain.ContractDO">
		select a.`Contract_ID`,a.`Customer_ID`,`Business_ID`,`Contract_Name`,
		`Contract_Build_Company`,`Contract_Type`,`Contract_Category`,`Contract_Total_Price`,
		`Contract_Dept`,`Contract_Applicant`,`Contract_Draft_Person`,`Contract_Sales`,`Contract_Commit_Time`,
		`Contract_Related_ID`,`Contract_Invoice_Type`,`Contract_Invoice_Time`,`Contract_Hardware_List`,
		`Contract_Software_List`,`Contract_Project_Management`,`Contract_Remarks`,`Contract_Attachment`,
		`Contract_Approval_Status`,`Contract_Operator`,`Contract_Operate_Time`,s.name as contractOperatorName,
		a.Project_ID,Contract_Applicant_Name
		from contract a
		left JOIN sys_user s on a.Contract_Operator = s.user_id
		left JOIN development_project d on a.Project_ID = d.Project_ID
		left join sales_company_customer c on a.Customer_ID = c.Customer_ID
		where a.Contract_ID = #{value}
	</select>

    <select id="getRecipient" resultType="com.bootdo.common.domain.MainDO">
        SELECT COUNT(Assignment_Recipient)as Recipient
        FROM approval_assignment
        WHERE  Assignment_Recipient = #{Recipient}

	</select>

    <select id="getPrincipal" resultType="com.bootdo.common.domain.MainDO">
        SELECT COUNT(Assignment_Principal)as Principal
        FROM approval_assignment
        WHERE  Assignment_Principal = #{Principal}

	</select>

    <select id="getUndoLog" resultType="com.bootdo.common.domain.MainDO">
        SELECT COUNT(DISTINCT Work_Day) as undoLog
        FROM work_day
        WHERE NOT EXISTS (SELECT TimeSheet_Date FROM timesheet WHERE Work_Day = TimeSheet_Date)
        AND Work_Day &lt; NOW() AND Work_Year = #{currentYear}

	</select>

    <select id="getLog" resultType="com.bootdo.common.domain.MainDO">
        SELECT COUNT(DISTINCT TimeSheet_Date) as log
        FROM timesheet
        WHERE YEAR(TimeSheet_Date) = #{currentYear}

	</select>


	<select id="view" resultType="com.bootdo.contract.domain.ContractDO">
		select a.`Contract_ID`, c.`Customer_Name`,b.`Business_Name`,e.Project_Name,e.`Employee_Name` as Contract_Applicant_Name,
		a.`Contract_Name`,a.`Contract_Build_Company`,a.`Contract_Type`,a.`Contract_Category`,
		a.`Contract_Total_Price`,e.`Employee_Name` as `Contract_Applicant`,a.`Contract_Draft_Person`,
		e.`Employee_Name` as `Contract_Sales`,a.`Contract_Commit_Time`, Contract_Name as Contract_Related_ID,
		a.`Contract_Invoice_Type`,a.`Contract_Invoice_Time`,a.`Contract_Hardware_List`,
		a.`Contract_Software_List`,a.`Contract_Remarks`
		from contract a
		left JOIN sys_user s on a.Contract_Operator = s.user_id
		left join sales_business b on a.Business_ID = b.Business_ID
		left join sales_company_customer c on a.Customer_ID = c.Customer_ID
		left JOIN (SELECT `Project_ID`,`Project_Name` from development_project
				   UNION ALL
				   select `Project_ID`,`Project_Name` from pre_sales_project h
         		   WHERE NOT EXISTS
         		   (select `Project_ID`,`Project_Name` from development_project i WHERE h.Project_ID = i.Project_ID)) e on a.Project_ID = e.Project_ID
		left join inner_org_employee e on a.Contract_Applicant_Name = e.Employee_ID
		where a.Contract_ID = #{value}
	</select>

	<select id="getDataList" resultType="com.bootdo.common.domain.MainDO">
		SELECT '项目合同金额' as name, CASE WHEN MONTH(Contract_Approval_Time) = '1'
			THEN SUM(Contract_Total_Price)END as 'January',
			CASE WHEN MONTH(Contract_Approval_Time) = '2'
			THEN SUM(Contract_Total_Price)END as 'February',
			CASE WHEN MONTH(Contract_Approval_Time) = '3'
			THEN SUM(Contract_Total_Price)END as 'March',
			CASE WHEN MONTH(Contract_Approval_Time) = '4'
			THEN SUM(Contract_Total_Price)END as 'April',
			CASE WHEN MONTH(Contract_Approval_Time) = '5'
			THEN SUM(Contract_Total_Price)END as 'May',
			CASE WHEN MONTH(Contract_Approval_Time) = '6'
			THEN SUM(Contract_Total_Price)END as 'June',
			CASE WHEN MONTH(Contract_Approval_Time) = '7'
			THEN SUM(Contract_Total_Price)END as 'July',
			CASE WHEN MONTH(Contract_Approval_Time) = '8'
			THEN SUM(Contract_Total_Price)END as 'August',
			CASE WHEN MONTH(Contract_Approval_Time) = '9'
			THEN SUM(Contract_Total_Price)END as 'September',
			CASE WHEN MONTH(Contract_Approval_Time) = '10'
			THEN SUM(Contract_Total_Price)END as 'October',
			CASE WHEN MONTH(Contract_Approval_Time) = '11'
			THEN SUM(Contract_Total_Price)END as 'November',
			CASE WHEN MONTH(Contract_Approval_Time) = '12'
			THEN SUM(Contract_Total_Price)END as 'December', SUM(Contract_Total_Price) as total
        FROM contract
        WHERE YEAR(Contract_Approval_Time) = #{currentYear} and Contract_Approval_Status = '1'
        UNION ALL
        SELECT '项目回款金额' as name, CASE WHEN MONTH(Received_Time) = '1'
			THEN SUM(Received_Price)END as '1月',
			CASE WHEN MONTH(Received_Time) = '2'
			THEN SUM(Received_Price)END as '2月',
			CASE WHEN MONTH(Received_Time) = '3'
			THEN SUM(Received_Price)END as '3月',
			CASE WHEN MONTH(Received_Time) = '4'
			THEN SUM(Received_Price)END as '4月',
			CASE WHEN MONTH(Received_Time) = '5'
			THEN SUM(Received_Price)END as '5月',
			CASE WHEN MONTH(Received_Time) = '6'
			THEN SUM(Received_Price)END as '6月',
			CASE WHEN MONTH(Received_Time) = '7'
			THEN SUM(Received_Price)END as '7月',
			CASE WHEN MONTH(Received_Time) = '8'
			THEN SUM(Received_Price)END as '8月',
			CASE WHEN MONTH(Received_Time) = '9'
			THEN SUM(Received_Price)END as '9月',
			CASE WHEN MONTH(Received_Time) = '10'
			THEN SUM(Received_Price)END as '10月',
			CASE WHEN MONTH(Received_Time) = '11'
			THEN SUM(Received_Price)END as '11月',
			CASE WHEN MONTH(Received_Time) = '12'
			THEN SUM(Received_Price)END as '12月', SUM(Received_Price) as total
        FROM payment_received
        WHERE YEAR(Received_Time) = #{currentYear}
        UNION ALL
        SELECT '项目付款金额' as name, CASE WHEN MONTH(Paid_Time) = '1'
			THEN SUM(Paid_Price)END as '1月',
			CASE WHEN MONTH(Paid_Time) = '2'
			THEN SUM(Paid_Price)END as '2月',
			CASE WHEN MONTH(Paid_Time) = '3'
			THEN SUM(Paid_Price)END as '3月',
			CASE WHEN MONTH(Paid_Time) = '4'
			THEN SUM(Paid_Price)END as '4月',
			CASE WHEN MONTH(Paid_Time) = '5'
			THEN SUM(Paid_Price)END as '5月',
			CASE WHEN MONTH(Paid_Time) = '6'
			THEN SUM(Paid_Price)END as '6月',
			CASE WHEN MONTH(Paid_Time) = '7'
			THEN SUM(Paid_Price)END as '7月',
			CASE WHEN MONTH(Paid_Time) = '8'
			THEN SUM(Paid_Price)END as '8月',
			CASE WHEN MONTH(Paid_Time) = '9'
			THEN SUM(Paid_Price)END as '9月',
			CASE WHEN MONTH(Paid_Time) = '10'
			THEN SUM(Paid_Price)END as '10月',
			CASE WHEN MONTH(Paid_Time) = '11'
			THEN SUM(Paid_Price)END as '11月',
			CASE WHEN MONTH(Paid_Time) = '12'
			THEN SUM(Paid_Price)END as '12月', sum(Paid_Price) as total
        FROM payment_paid
        WHERE YEAR(Paid_Time) = #{currentYear}
        UNION ALL
        SELECT '项目人力成本' as name, CASE WHEN MONTH(TimeSheet_Approval_Time) = '1'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '1月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '2'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '2月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '3'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '3月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '4'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '4月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '5'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '5月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '6'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '6月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '7'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '7月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '8'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '8月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '9'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '9月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '10'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '10月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '11'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '11月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '12'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '12月',
			SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour) as total
        FROM timesheet a
        LEFT JOIN inner_org_employee b on a.Employee_ID = b.Employee_ID
        WHERE YEAR(TimeSheet_Approval_Time) = #{currentYear} and TimeSheet_Approval_Status = '1'
        UNION ALL
        SELECT '项目差旅报销' as name, CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '1'
			THEN SUM(Expenses_Travel_Pay_Price)END as '1月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '2'
			THEN SUM(Expenses_Travel_Pay_Price)END as '2月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '3'
			THEN SUM(Expenses_Travel_Pay_Price)END as '3月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '4'
			THEN SUM(Expenses_Travel_Pay_Price)END as '4月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '5'
			THEN SUM(Expenses_Travel_Pay_Price)END as '5月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '6'
			THEN SUM(Expenses_Travel_Pay_Price)END as '6月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '7'
			THEN SUM(Expenses_Travel_Pay_Price)END as '7月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '8'
			THEN SUM(Expenses_Travel_Pay_Price)END as '8月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '9'
			THEN SUM(Expenses_Travel_Pay_Price)END as '9月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '10'
			THEN SUM(Expenses_Travel_Pay_Price)END as '10月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '11'
			THEN SUM(Expenses_Travel_Pay_Price)END as '11月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '12'
			THEN SUM(Expenses_Travel_Pay_Price)END as '12月', sum(Expenses_Travel_Pay_Price) as total
        FROM approval_expenses__travel
        WHERE YEAR(Expenses_Travel_Approval_Time) = #{currentYear} and Expenses_Travel_Status = '1'
        UNION ALL
        SELECT '其他报销' as name, CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '1'
			THEN SUM(Expenses_Normal_Price)END as '1月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '2'
			THEN SUM(Expenses_Normal_Price)END as '2月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '3'
			THEN SUM(Expenses_Normal_Price)END as '3月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '4'
			THEN SUM(Expenses_Normal_Price)END as '4月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '5'
			THEN SUM(Expenses_Normal_Price)END as '5月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '6'
			THEN SUM(Expenses_Normal_Price)END as '6月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '7'
			THEN SUM(Expenses_Normal_Price)END as '7月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '8'
			THEN SUM(Expenses_Normal_Price)END as '8月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '9'
			THEN SUM(Expenses_Normal_Price)END as '9月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '10'
			THEN SUM(Expenses_Normal_Price)END as '10月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '11'
			THEN SUM(Expenses_Normal_Price)END as '11月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '12'
			THEN SUM(Expenses_Normal_Price)END as '12月', sum(Expenses_Normal_Price) as total
        FROM approval_expenses_normal
        WHERE YEAR(Expenses_Normal_Approval_Time) = #{currentYear} and Expenses_Normal_Status = '1'
        UNION ALL
        SELECT '项目采购成本' as name, CASE WHEN MONTH(Purchase_Approval_Time) = '1'
			THEN SUM(Purchase_Total_Price)END as '1月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '2'
			THEN SUM(Purchase_Total_Price)END as '2月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '3'
			THEN SUM(Purchase_Total_Price)END as '3月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '4'
			THEN SUM(Purchase_Total_Price)END as '4月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '5'
			THEN SUM(Purchase_Total_Price)END as '5月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '6'
			THEN SUM(Purchase_Total_Price)END as '6月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '7'
			THEN SUM(Purchase_Total_Price)END as '7月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '8'
			THEN SUM(Purchase_Total_Price)END as '8月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '9'
			THEN SUM(Purchase_Total_Price)END as '9月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '10'
			THEN SUM(Purchase_Total_Price)END as '10月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '11'
			THEN SUM(Purchase_Total_Price)END as '11月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '12'
			THEN SUM(Purchase_Total_Price)END as '12月', sum(Purchase_Total_Price) as total
        FROM approval_purchase
        WHERE YEAR(Purchase_Approval_Time) = #{currentYear} and Purchase_Approval_Status = '1'

	</select>

    <select id="getFinanceDataList" resultType="com.bootdo.common.domain.MainDO">
		SELECT '项目合同金额' as name, CASE WHEN MONTH(Contract_Approval_Time) = '1'
			THEN SUM(Contract_Total_Price)END as 'January',
			CASE WHEN MONTH(Contract_Approval_Time) = '2'
			THEN SUM(Contract_Total_Price)END as 'February',
			CASE WHEN MONTH(Contract_Approval_Time) = '3'
			THEN SUM(Contract_Total_Price)END as 'March',
			CASE WHEN MONTH(Contract_Approval_Time) = '4'
			THEN SUM(Contract_Total_Price)END as 'April',
			CASE WHEN MONTH(Contract_Approval_Time) = '5'
			THEN SUM(Contract_Total_Price)END as 'May',
			CASE WHEN MONTH(Contract_Approval_Time) = '6'
			THEN SUM(Contract_Total_Price)END as 'June',
			CASE WHEN MONTH(Contract_Approval_Time) = '7'
			THEN SUM(Contract_Total_Price)END as 'July',
			CASE WHEN MONTH(Contract_Approval_Time) = '8'
			THEN SUM(Contract_Total_Price)END as 'August',
			CASE WHEN MONTH(Contract_Approval_Time) = '9'
			THEN SUM(Contract_Total_Price)END as 'September',
			CASE WHEN MONTH(Contract_Approval_Time) = '10'
			THEN SUM(Contract_Total_Price)END as 'October',
			CASE WHEN MONTH(Contract_Approval_Time) = '11'
			THEN SUM(Contract_Total_Price)END as 'November',
			CASE WHEN MONTH(Contract_Approval_Time) = '12'
			THEN SUM(Contract_Total_Price)END as 'December', SUM(Contract_Total_Price) as total
        FROM contract
        WHERE YEAR(Contract_Approval_Time) = #{currentYear} and Contract_Approval_Status = '1'
        and Project_ID = #{projectId}
        UNION ALL
        SELECT '项目回款金额' as name, CASE WHEN MONTH(Received_Time) = '1'
			THEN SUM(Received_Price)END as '1月',
			CASE WHEN MONTH(Received_Time) = '2'
			THEN SUM(Received_Price)END as '2月',
			CASE WHEN MONTH(Received_Time) = '3'
			THEN SUM(Received_Price)END as '3月',
			CASE WHEN MONTH(Received_Time) = '4'
			THEN SUM(Received_Price)END as '4月',
			CASE WHEN MONTH(Received_Time) = '5'
			THEN SUM(Received_Price)END as '5月',
			CASE WHEN MONTH(Received_Time) = '6'
			THEN SUM(Received_Price)END as '6月',
			CASE WHEN MONTH(Received_Time) = '7'
			THEN SUM(Received_Price)END as '7月',
			CASE WHEN MONTH(Received_Time) = '8'
			THEN SUM(Received_Price)END as '8月',
			CASE WHEN MONTH(Received_Time) = '9'
			THEN SUM(Received_Price)END as '9月',
			CASE WHEN MONTH(Received_Time) = '10'
			THEN SUM(Received_Price)END as '10月',
			CASE WHEN MONTH(Received_Time) = '11'
			THEN SUM(Received_Price)END as '11月',
			CASE WHEN MONTH(Received_Time) = '12'
			THEN SUM(Received_Price)END as '12月', SUM(Received_Price) as total
        FROM payment_received a
				LEFT JOIN contract b on a.Contract_ID = b.Contract_ID
        WHERE YEAR(Received_Time) = #{currentYear} and b.Project_ID = #{projectId}
        UNION ALL
        SELECT '项目付款金额' as name, CASE WHEN MONTH(Paid_Time) = '1'
			THEN SUM(Paid_Price)END as '1月',
			CASE WHEN MONTH(Paid_Time) = '2'
			THEN SUM(Paid_Price)END as '2月',
			CASE WHEN MONTH(Paid_Time) = '3'
			THEN SUM(Paid_Price)END as '3月',
			CASE WHEN MONTH(Paid_Time) = '4'
			THEN SUM(Paid_Price)END as '4月',
			CASE WHEN MONTH(Paid_Time) = '5'
			THEN SUM(Paid_Price)END as '5月',
			CASE WHEN MONTH(Paid_Time) = '6'
			THEN SUM(Paid_Price)END as '6月',
			CASE WHEN MONTH(Paid_Time) = '7'
			THEN SUM(Paid_Price)END as '7月',
			CASE WHEN MONTH(Paid_Time) = '8'
			THEN SUM(Paid_Price)END as '8月',
			CASE WHEN MONTH(Paid_Time) = '9'
			THEN SUM(Paid_Price)END as '9月',
			CASE WHEN MONTH(Paid_Time) = '10'
			THEN SUM(Paid_Price)END as '10月',
			CASE WHEN MONTH(Paid_Time) = '11'
			THEN SUM(Paid_Price)END as '11月',
			CASE WHEN MONTH(Paid_Time) = '12'
			THEN SUM(Paid_Price)END as '12月', sum(Paid_Price) as total
        FROM payment_paid a
				LEFT JOIN contract b on a.Contract_ID = b.Contract_ID
        WHERE YEAR(Paid_Time) = #{currentYear} and b.Project_ID = #{projectId}
        UNION ALL
        SELECT '项目人力成本' as name, CASE WHEN MONTH(TimeSheet_Approval_Time) = '1'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '1月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '2'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '2月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '3'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '3月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '4'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '4月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '5'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '5月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '6'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '6月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '7'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '7月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '8'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '8月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '9'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '9月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '10'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '10月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '11'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '11月',
			CASE WHEN MONTH(TimeSheet_Approval_Time) = '12'
			THEN SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour)END as '12月',
			SUM(a.TimeSheet_Normal * b.Employee_Salary_Hour +
			        a.TimeSheet_Overtime * b.Employee_Salary_Hour) as total
        FROM timesheet a
        LEFT JOIN inner_org_employee b on a.Employee_ID = b.Employee_ID
        WHERE YEAR(TimeSheet_Approval_Time) = #{currentYear} and TimeSheet_Approval_Status = '1'
        and a.Project_ID = #{projectId}
        UNION ALL
        SELECT '项目差旅报销' as name, CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '1'
			THEN SUM(Expenses_Travel_Pay_Price)END as '1月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '2'
			THEN SUM(Expenses_Travel_Pay_Price)END as '2月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '3'
			THEN SUM(Expenses_Travel_Pay_Price)END as '3月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '4'
			THEN SUM(Expenses_Travel_Pay_Price)END as '4月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '5'
			THEN SUM(Expenses_Travel_Pay_Price)END as '5月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '6'
			THEN SUM(Expenses_Travel_Pay_Price)END as '6月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '7'
			THEN SUM(Expenses_Travel_Pay_Price)END as '7月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '8'
			THEN SUM(Expenses_Travel_Pay_Price)END as '8月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '9'
			THEN SUM(Expenses_Travel_Pay_Price)END as '9月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '10'
			THEN SUM(Expenses_Travel_Pay_Price)END as '10月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '11'
			THEN SUM(Expenses_Travel_Pay_Price)END as '11月',
			CASE WHEN MONTH(Expenses_Travel_Approval_Time) = '12'
			THEN SUM(Expenses_Travel_Pay_Price)END as '12月', sum(Expenses_Travel_Pay_Price) as total
        FROM approval_expenses__travel
        WHERE YEAR(Expenses_Travel_Approval_Time) = #{currentYear} and Expenses_Travel_Status = '1'
        AND Project_ID = #{projectId}
        UNION ALL
        SELECT '其他报销' as name, CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '1'
			THEN SUM(Expenses_Normal_Price)END as '1月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '2'
			THEN SUM(Expenses_Normal_Price)END as '2月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '3'
			THEN SUM(Expenses_Normal_Price)END as '3月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '4'
			THEN SUM(Expenses_Normal_Price)END as '4月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '5'
			THEN SUM(Expenses_Normal_Price)END as '5月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '6'
			THEN SUM(Expenses_Normal_Price)END as '6月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '7'
			THEN SUM(Expenses_Normal_Price)END as '7月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '8'
			THEN SUM(Expenses_Normal_Price)END as '8月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '9'
			THEN SUM(Expenses_Normal_Price)END as '9月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '10'
			THEN SUM(Expenses_Normal_Price)END as '10月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '11'
			THEN SUM(Expenses_Normal_Price)END as '11月',
			CASE WHEN MONTH(Expenses_Normal_Approval_Time) = '12'
			THEN SUM(Expenses_Normal_Price)END as '12月', sum(Expenses_Normal_Price) as total
        FROM approval_expenses_normal
        WHERE YEAR(Expenses_Normal_Approval_Time) = #{currentYear} and Expenses_Normal_Status = '1'
        AND Project_ID = #{projectId}
        UNION ALL
        SELECT '项目采购成本' as name, CASE WHEN MONTH(Purchase_Approval_Time) = '1'
			THEN SUM(Purchase_Total_Price)END as '1月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '2'
			THEN SUM(Purchase_Total_Price)END as '2月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '3'
			THEN SUM(Purchase_Total_Price)END as '3月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '4'
			THEN SUM(Purchase_Total_Price)END as '4月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '5'
			THEN SUM(Purchase_Total_Price)END as '5月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '6'
			THEN SUM(Purchase_Total_Price)END as '6月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '7'
			THEN SUM(Purchase_Total_Price)END as '7月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '8'
			THEN SUM(Purchase_Total_Price)END as '8月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '9'
			THEN SUM(Purchase_Total_Price)END as '9月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '10'
			THEN SUM(Purchase_Total_Price)END as '10月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '11'
			THEN SUM(Purchase_Total_Price)END as '11月',
			CASE WHEN MONTH(Purchase_Approval_Time) = '12'
			THEN SUM(Purchase_Total_Price)END as '12月', sum(Purchase_Total_Price) as total
        FROM approval_purchase
        WHERE YEAR(Purchase_Approval_Time) = #{currentYear} and Purchase_Approval_Status = '1'
        AND Project_ID = #{projectId}

	</select>

	<select id="list" resultType="com.bootdo.contract.domain.ContractDO">
		select DISTINCT a.`Contract_ID`,a.`Customer_ID`,`Business_ID`,`Contract_Name`,`Contract_Applicant_Name`,
		`Contract_Build_Company`,`Contract_Type`,`Contract_Category`,`Contract_Total_Price`,
		`Contract_Dept`,`Contract_Applicant`,`Contract_Draft_Person`,h.Employee_Name as `Contract_Sales`,`Contract_Commit_Time`,
		`Contract_Related_ID`,`Contract_Invoice_Type`,`Contract_Invoice_Time`,`Contract_Hardware_List`,
		`Contract_Software_List`,`Contract_Project_Management`,`Contract_Remarks`,`Contract_Attachment`,
		case when `Contract_Approval_Status` = '1' then '已审批'
		when `Contract_Approval_Status` = '0' then '未审批' end as Contract_Approval_Status,
		`Contract_Operator`,`Contract_Operate_Time`,s.name as contractOperatorName,
		a.Project_ID, PROCESS_INSTANCE_ID
		from contract a
		left JOIN sys_user s on a.Contract_Operator = s.user_id
		left JOIN development_project d on a.Project_ID = d.Project_ID
		left join sales_company_customer c on a.Customer_ID = c.Customer_ID
		LEFT JOIN main_and_copy_person e on a.Contract_ID = e.T_ID
		LEFT JOIN inner_org_employee h on a.Contract_Sales = h.Employee_ID
        <where>  
		  		  <if test="contractId != null and contractId != ''"> and Contract_ID = #{contractId} </if>
		  		  <if test="customerId != null and customerId != ''"> and a.Customer_ID = #{customerId} </if>
		  		  <if test="businessId != null and businessId != ''"> and Business_ID = #{businessId} </if>
		  		  <if test="contractName != null and contractName != ''"> and Contract_Name = #{contractName} </if>
		  		  <if test="contractApplicantName != null and contractApplicantName != ''"> and Contract_Applicant_Name = #{contractApplicantName} </if>
		  		  <if test="contractBuildCompany != null and contractBuildCompany != ''"> and Contract_Build_Company = #{contractBuildCompany} </if>
		  		  <if test="contractType != null and contractType != ''"> and Contract_Type = #{contractType} </if>
		  		  <if test="contractCategory != null and contractCategory != ''"> and Contract_Category = #{contractCategory} </if>
		  		  <if test="contractTotalPrice != null and contractTotalPrice != ''"> and Contract_Total_Price = #{contractTotalPrice} </if>
		  		  <if test="contractDept != null and contractDept != ''"> and Contract_Dept = #{contractDept} </if>
		  		  <if test="contractApplicant != null and contractApplicant != ''"> and Contract_Applicant = #{contractApplicant} </if>
		  		  <if test="contractDraftPerson != null and contractDraftPerson != ''"> and Contract_Draft_Person = #{contractDraftPerson} </if>
		  		  <if test="contractSales != null and contractSales != ''"> and Contract_Sales = #{contractSales} </if>
		  		  <if test="contractCommitTime != null and contractCommitTime != ''"> and Contract_Commit_Time = #{contractCommitTime} </if>
		  		  <if test="contractRelatedId != null and contractRelatedId != ''"> and Contract_Related_ID = #{contractRelatedId} </if>
		  		  <if test="contractInvoiceType != null and contractInvoiceType != ''"> and Contract_Invoice_Type = #{contractInvoiceType} </if>
		  		  <if test="contractInvoiceTime != null and contractInvoiceTime != ''"> and Contract_Invoice_Time = #{contractInvoiceTime} </if>
		  		  <if test="contractHardwareList != null and contractHardwareList != ''"> and Contract_Hardware_List = #{contractHardwareList} </if>
		  		  <if test="contractSoftwareList != null and contractSoftwareList != ''"> and Contract_Software_List = #{contractSoftwareList} </if>
		  		  <if test="contractProjectManagement != null and contractProjectManagement != ''"> and Contract_Project_Management = #{contractProjectManagement} </if>
		  		  <if test="contractRemarks != null and contractRemarks != ''"> and Contract_Remarks = #{contractRemarks} </if>
		  		  <if test="contractAttachment != null and contractAttachment != ''"> and Contract_Attachment = #{contractAttachment} </if>
		  		  <if test="contractApprovalStatus != null and contractApprovalStatus != ''"> and Contract_Approval_Status = #{contractApprovalStatus} </if>
		  		  <if test="userId != null and userId != ''"> and ((a.Contract_Operator = #{userId}
																					  or EXISTS(SELECT 1 FROM main_and_copy_person f
																					  LEFT JOIN inner_org_employee g on f.Employee_ID = g.Employee_ID
																					  WHERE g.Inner_User_ID = #{userName} and f.Table_Name = #{tableName} and f.t_id=a.Contract_id))
																					  or EXISTS(SELECT 1 from sys_user
																					  WHERE user_id = #{userId} and Identification = '1')) </if>
		  		  <if test="contractOperateTime != null and contractOperateTime != ''"> and Contract_Operate_Time = #{contractOperateTime} </if>
		  		  <if test="projectId != null and projectId != ''"> and a.Project_ID = #{projectId} </if>
		  		</where>
        <choose>
            <when test="sort != null and sort.trim() != ''">
                order by ${sort} ${order}
            </when>
			<otherwise>
                order by Contract_ID desc
			</otherwise>
        </choose>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
	</select>
	
 	<select id="count" resultType="int">
		select count(*) from contract a
		left JOIN sys_user s on a.Contract_Operator = s.user_id
		left JOIN development_project d on a.Project_ID = d.Project_ID
		left join sales_company_customer c on a.Customer_ID = c.Customer_ID
		 <where>  
		  		  <if test="contractId != null and contractId != ''"> and Contract_ID = #{contractId} </if>
		  		  <if test="customerId != null and customerId != ''"> and a.Customer_ID = #{customerId} </if>
		  		  <if test="businessId != null and businessId != ''"> and Business_ID = #{businessId} </if>
		  		  <if test="contractName != null and contractName != ''"> and Contract_Name = #{contractName} </if>
		  		  <if test="contractApplicantName != null and contractApplicantName != ''"> and Contract_Applicant_Name = #{contractApplicantName} </if>
		  		  <if test="contractBuildCompany != null and contractBuildCompany != ''"> and Contract_Build_Company = #{contractBuildCompany} </if>
		  		  <if test="contractType != null and contractType != ''"> and Contract_Type = #{contractType} </if>
		  		  <if test="contractCategory != null and contractCategory != ''"> and Contract_Category = #{contractCategory} </if>
		  		  <if test="contractTotalPrice != null and contractTotalPrice != ''"> and Contract_Total_Price = #{contractTotalPrice} </if>
		  		  <if test="contractDept != null and contractDept != ''"> and Contract_Dept = #{contractDept} </if>
		  		  <if test="contractApplicant != null and contractApplicant != ''"> and Contract_Applicant = #{contractApplicant} </if>
		  		  <if test="contractDraftPerson != null and contractDraftPerson != ''"> and Contract_Draft_Person = #{contractDraftPerson} </if>
		  		  <if test="contractSales != null and contractSales != ''"> and Contract_Sales = #{contractSales} </if>
		  		  <if test="contractCommitTime != null and contractCommitTime != ''"> and Contract_Commit_Time = #{contractCommitTime} </if>
		  		  <if test="contractRelatedId != null and contractRelatedId != ''"> and Contract_Related_ID = #{contractRelatedId} </if>
		  		  <if test="contractInvoiceType != null and contractInvoiceType != ''"> and Contract_Invoice_Type = #{contractInvoiceType} </if>
		  		  <if test="contractInvoiceTime != null and contractInvoiceTime != ''"> and Contract_Invoice_Time = #{contractInvoiceTime} </if>
		  		  <if test="contractHardwareList != null and contractHardwareList != ''"> and Contract_Hardware_List = #{contractHardwareList} </if>
		  		  <if test="contractSoftwareList != null and contractSoftwareList != ''"> and Contract_Software_List = #{contractSoftwareList} </if>
		  		  <if test="contractProjectManagement != null and contractProjectManagement != ''"> and Contract_Project_Management = #{contractProjectManagement} </if>
		  		  <if test="contractRemarks != null and contractRemarks != ''"> and Contract_Remarks = #{contractRemarks} </if>
		  		  <if test="contractAttachment != null and contractAttachment != ''"> and Contract_Attachment = #{contractAttachment} </if>
		  		  <if test="contractApprovalStatus != null and contractApprovalStatus != ''"> and Contract_Approval_Status = #{contractApprovalStatus} </if>
		  		  <if test="contractOperator != null and contractOperator != ''"> and s.name = #{contractOperator} </if>
		  		  <if test="contractOperateTime != null and contractOperateTime != ''"> and Contract_Operate_Time = #{contractOperateTime} </if>
		  		  <if test="projectId != null and projectId != ''"> and a.Project_ID = #{projectId} </if>
		  		</where>
	</select>
	<insert id="save" parameterType="com.bootdo.contract.domain.ContractDO" useGeneratedKeys="true" keyProperty="contractId">
		insert into contract
		(
			`Contract_ID`,
			`Customer_ID`,
			`Business_ID`, 
			`Contract_Name`, 
			`Contract_Applicant_Name`,
			`Contract_Build_Company`, 
			`Contract_Type`, 
			`Contract_Category`, 
			`Contract_Total_Price`, 
			`Contract_Dept`, 
			`Contract_Applicant`, 
			`Contract_Draft_Person`, 
			`Contract_Sales`, 
			`Contract_Commit_Time`, 
			`Contract_Related_ID`, 
			`Contract_Invoice_Type`, 
			`Contract_Invoice_Time`, 
			`Contract_Hardware_List`, 
			`Contract_Software_List`, 
			`Contract_Project_Management`, 
			`Contract_Remarks`, 
			`Contract_Attachment`, 
			`Contract_Operator`,
			`Contract_Operate_Time`,
			`Project_ID`
		)
		values
		(
			#{contractId},
			#{customerId},
			#{businessId}, 
			#{contractName}, 
			#{contractApplicantName},
			#{contractBuildCompany}, 
			#{contractType}, 
			#{contractCategory}, 
			#{contractTotalPrice}, 
			#{contractDept}, 
			#{contractApplicant}, 
			#{contractDraftPerson}, 
			#{contractSales}, 
			#{contractCommitTime}, 
			#{contractRelatedId}, 
			#{contractInvoiceType}, 
			case when #{contractInvoiceTime}='' then null else #{contractInvoiceTime} end,
			#{contractHardwareList}, 
			#{contractSoftwareList}, 
			#{contractProjectManagement}, 
			#{contractRemarks}, 
			#{contractAttachment}, 
			#{contractOperator},
			#{contractOperateTime},
			#{projectId}
		)
	</insert>
	 
	<update id="update" parameterType="com.bootdo.contract.domain.ContractDO">
		update contract 
		<set>
			<if test="businessId != null">`Business_ID` = #{businessId}, </if>
			<if test="contractName != null">`Contract_Name` = #{contractName}, </if>
			<if test="contractApplicantName != null">`Contract_Applicant_Name` = #{contractApplicantName}, </if>
			<if test="contractBuildCompany != null">`Contract_Build_Company` = #{contractBuildCompany}, </if>
			<if test="contractType != null">`Contract_Type` = #{contractType}, </if>
			<if test="contractCategory != null">`Contract_Category` = #{contractCategory}, </if>
			<if test="contractTotalPrice != null">`Contract_Total_Price` = #{contractTotalPrice}, </if>
			<if test="contractDept != null">`Contract_Dept` = #{contractDept}, </if>
			<if test="contractApplicant != null">`Contract_Applicant` = #{contractApplicant}, </if>
			<if test="contractDraftPerson != null">`Contract_Draft_Person` = #{contractDraftPerson}, </if>
			<if test="contractSales != null">`Contract_Sales` = #{contractSales}, </if>
			<if test="contractCommitTime != null">`Contract_Commit_Time` = #{contractCommitTime}, </if>
			<if test="contractRelatedId != null">`Contract_Related_ID` = #{contractRelatedId}, </if>
			<if test="contractInvoiceType != null">`Contract_Invoice_Type` = #{contractInvoiceType}, </if>
			<if test="contractInvoiceTime != null and contractInvoiceTime != ''">`Contract_Invoice_Time` = #{contractInvoiceTime}, </if>
			<if test="contractHardwareList != null">`Contract_Hardware_List` = #{contractHardwareList}, </if>
			<if test="contractSoftwareList != null">`Contract_Software_List` = #{contractSoftwareList}, </if>
			<if test="contractProjectManagement != null">`Contract_Project_Management` = #{contractProjectManagement}, </if>
			<if test="contractRemarks != null">`Contract_Remarks` = #{contractRemarks}, </if>
			<if test="contractAttachment != null">`Contract_Attachment` = #{contractAttachment}, </if>
			<if test="contractApprovalStatus != null">`Contract_Approval_Status` = #{contractApprovalStatus}, </if>
			<if test="contractOperator != null">`Contract_Operator` = #{contractOperator}, </if>
			<if test="contractOperateTime != null">`Contract_Operate_Time` = #{contractOperateTime},</if>
			<if test="projectId != null and projectId != ''">Project_ID = #{projectId}, </if>
			<if test="processInstanceId != null">`PROCESS_INSTANCE_ID` = #{processInstanceId}</if>
		</set>
		where Contract_ID = #{contractId}
	</update>
	
	<delete id="remove">
		delete from contract where Contract_ID = #{value}
	</delete>
	
	<delete id="batchRemove">
		delete from contract where Contract_ID in 
		<foreach item="contractId" collection="array" open="(" separator="," close=")">
			#{contractId}
		</foreach>
	</delete>
	<!-- 合同名称 -->
	<select id="listDic" resultType="com.bootdo.common.domain.DictDO">
		select `Contract_ID` value,concat(`Contract_ID`,' ',`Contract_Name`) name
		from contract
	</select>
</mapper>